generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(uuid())
  email       String   @unique
  passwordHash String?
  name        String?
  provider    String   @default("email")
  providerId  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  orders      Order[]
  cart        Cart?
}

model Product {
  id         String    @id @default(uuid())
  title      String
  slug       String    @unique
  description String?
  price      Decimal   @db.Decimal(10,2)
  category   String
  hasPendant Boolean   @default(false)
  images     ProductImage[]
  variants   ProductVariant[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model ProductVariant {
  id         String   @id @default(uuid())
  product    Product  @relation(fields: [productId], references: [id])
  productId  String
  sku        String   @unique
  material   String?
  weightGr   Float?
  stock      Int      @default(0)
}

model PendantOption {
  id             String   @id @default(uuid())
  product        Product  @relation(fields: [productId], references: [id])
  productId      String
  color          String
  sku            String?
  priceAdjustment Decimal? @db.Decimal(10,2)
}

model ProductImage {
  id        String  @id @default(uuid())
  product   Product @relation(fields: [productId], references: [id])
  productId String
  url       String
  altText   String?
  order     Int     @default(0)
}

model Cart {
  id        String     @id @default(uuid())
  user      User?      @relation(fields: [userId], references: [id])
  userId    String?
  items     CartItem[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model CartItem {
  id              String  @id @default(uuid())
  cart            Cart    @relation(fields: [cartId], references: [id])
  cartId          String
  productVariant  ProductVariant @relation(fields: [productVariantId], references: [id])
  productVariantId String
  pendantOption   PendantOption? @relation(fields: [pendantOptionId], references: [id])
  pendantOptionId String?
  quantity        Int
}

model Order {
  id          String      @id @default(uuid())
  user        User?       @relation(fields: [userId], references: [id])
  userId      String?
  total       Decimal     @db.Decimal(12,2)
  status      String
  shippingAddress Json?
  paymentMeta Json?
  items       OrderItem[]
  createdAt   DateTime    @default(now())
}

model OrderItem {
  id              String   @id @default(uuid())
  order           Order    @relation(fields: [orderId], references: [id])
  orderId         String
  productVariant  ProductVariant @relation(fields: [productVariantId], references: [id])
  productVariantId String
  pendantOption   PendantOption? @relation(fields: [pendantOptionId], references: [id])
  pendantOptionId String?
  price           Decimal  @db.Decimal(10,2)
  quantity        Int
}

model AdminUser {
  id          String   @id @default(uuid())
  email       String   @unique
  passwordHash String
  role        String
  lastLogin   DateTime?
}

model AuditLog {
  id        String   @id @default(uuid())
  actorId   String?
  action    String
  entity    String
  entityId  String?
  data      Json?
  createdAt DateTime @default(now())
}
